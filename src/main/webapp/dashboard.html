<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <title>SIM - Dashboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="css/styles.css">
</head>

<body>
  <main class="container" role="main">
    <nav class="top" aria-label="Top navigation">
      <div class="left">
        <button id="btnHome" class="btn">Home</button>
      </div>
      <div class="right">
        <button id="btnAdmin" class="btn btn-primary" style="display:none">Admin</button>
        <button id="btnLogout" class="btn">Logout</button>
      </div>
    </nav>

    <header class="header" role="banner">
      <img src="img/logo.svg" alt="SIM logo" class="site-logo" />
      <div>
        <h1>SIM</h1>
        <p class="meta">Secure Instant Messaging &amp; management</p>
      </div>
    </header>

    <section class="dashboard-intro">
      <div class="card">
        <p style="margin:0">Use the navigation above. Admin functions are available to all authenticated users.</p>
      </div>

      <div class="card" id="dbCard" style="display:flex;flex-direction:column;gap:12px">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <h3 style="margin:0">Database configuration</h3>
            <p class="small" style="margin:6px 0 0">Manage DB connection and run migrations (admin only).</p>
          </div>
          <div>
            <a id="dbLink" class="btn btn-primary" href="admin" style="display:none">Open DB Configuration</a>
          </div>
        </div>
      </div>
    </section>

    <footer style="margin-top:18px;text-align:center;color:var(--muted);font-size:0.9rem">
      Signed in as: <span id="who">Not signed in</span>
    </footer>
  </main>

  <script>
    // Helper: compute app context path (e.g. "/chat-server" or "" for root)
    function appContextPath() {
      const p = window.location.pathname.split('/');
      return (p.length > 1 && p[1]) ? '/' + p[1] : '';
    }

    (function init() {
      const user = localStorage.getItem('username') || '';
      // show ADMIN for everyone that has a JWT stored
      const token = localStorage.getItem('jwt');
      const role = token ? 'ADMIN' : (localStorage.getItem('role') || '').toUpperCase();
      document.getElementById('who').textContent = user ? (user + ' (' + role + ')') : 'Not signed in';

      if (token) {
        document.getElementById('btnAdmin').style.display = 'inline-block';
        document.getElementById('dbLink').style.display = 'inline-block';
      }

      if (!token) {
        const ctx = appContextPath();
        window.location.href = window.location.origin + ctx + '/index.html';
      }
    })();

    document.getElementById('btnHome').onclick = function () {
      const ctx = appContextPath();
      window.location.href = window.location.origin + ctx + '/dashboard.html';
    };
    document.getElementById('btnAdmin').onclick = function () {
      const ctx = appContextPath();
      window.location.href = window.location.origin + ctx + '/admin';
    };
    document.getElementById('btnLogout').onclick = function () {
      document.cookie = 'CHAT_JWT=;path=/;max-age=0';
      localStorage.clear();
      const ctx = appContextPath();
      window.location.href = window.location.origin + ctx + '/index.html';
    };
  </script>
</body>

</html>